<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../../bower_components/iron-swipeable-container/iron-swipeable-container.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<!--
  appStorageKey
  dataURL
-->
<dom-module id="ck-quotepage">
  <template>
    <style>
      :host {
        height: 100vh;
        padding: 15px;
        @apply --layout-horizontal;
        @apply --layout-wrap;
        @apply --layout-center-aligned;
      }

      iron-pages {
        @apply --layout-flex;
        flex-basis: 100%;
      }

      [role="quote"] {
        margin-bottom: 10px;
        font-size: 1.5em;
        line-height: 1.3em;
      }

      [role="status"] {
        padding-top: 5px;
        text-align: right;
      }
    </style>

    <iron-ajax
      auto
      url="{{dataUrl}}"
      method="GET"
      handle-as="json"
      last-response={{quotes}}
    ></iron-ajax>

    <app-indexeddb-mirror
      key="{{appStorageKey}}"
      data="{{quotes}}"
      persisted-data="{{cacheQuotes}}"
    ></app-indexeddb-mirror>

    <iron-pages selected="{{selected}}">
      <template is="dom-repeat" items=[[cacheQuotes.quotes]]>
        <div role="quote">{{item.body}}</div>
      </template>
    </iron-pages>

    <div role="navigation">
      <paper-button disabled="[[noPrevPage(selected)]]" raised on-click="prevQuote">Previous</paper-button>
      <paper-button disabled="[[noNextPage(selected, cacheQuotes)]]" raised on-click="nextQuote">Next</paper-button>

      <div role="status">
        Quote [[inc(selected, 1)]] of [[lengthOf(cacheQuotes)]]
      </div>
    </div>

  </template>

  <script>
    /** @polymerElement */
    class CkQuotepage extends Polymer.Element {
      static get is() { return 'ck-quotepage'; }
      static get properties() {
        return {
          appStorageKey: {
            type: String,
            value: "cara-iu-vau"
          },
          dataUrl: {
            type: String
          },
          selected: {
            type: Number,
            value: 0
          }
        };
      }

      nextQuote() {
        this.selected += 1;
      }

      prevQuote() {
        this.selected -= 1;
      }

      lengthOf(cacheQuotes) {
        return cacheQuotes.quotes.length;
      }

      noNextPage(selected, cacheQuotes) {
        if (cacheQuotes) {
          return selected >= this.lengthOf(this.cacheQuotes);
        }
      }

      noPrevPage(selected) {
        return this.selected <= 0;
      }

      inc(value, by) {
        return value + by;
      }
    }

    window.customElements.define(CkQuotepage.is, CkQuotepage);
  </script>
</dom-module>
