<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../../bower_components/iron-swipeable-container/iron-swipeable-container.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">

<!--<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">-->
<!--<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">-->

<dom-module id="quote_center-app">
  <template>
    <style>
      :host {
        display: block;
        font: 1.1em Courier, sans-serif;
        width: 50%;
        line-height: 1.5em;
        text-shadow: -1px 0 1px #d6d5d5, -2px 0 0 #eaeaea;
        color: #505050;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        cursor: default;

        --paper-tabs-content: {
          background: var(--google-grey-100);
          color: var(--paper-indigo-a400);
        }

        --paper-tabs-selection-bar-color: var(--google-green-500);
      }

      div {
        padding: 8px 0;
      }

      header, footer {
        font-size: 0.8em;
        box-shadow: 0 -1px 0 #888;
      }

      header {
        box-shadow: 0 1px 0 #888;
      }

      @media (max-width: 1024px) {
        :host {
          width: 100%;
        }

        div {
          height: 70vh;
          padding: 0 3vw;
          margin-bottom: 1vh;
          @apply(--layout);
          @apply(--layout-center);
          @apply(--layout-center-justified);
          box-shadow: -1px 0 0 #aaa,
                      1px 0 0 #aaa,
                      0 -1px 0 #aaa,
                      0 1px 0 #aaa;
        }
      }

    </style>

    <header>
      <paper-tabs selected={{selected}} noink>
        <paper-tab>JimRohn</paper-tab>
        <paper-tab>JimRohn Custom</paper-tab>
      </paper-tabs>
    </header>

    <iron-ajax
      auto
      url="{{dataUrl}}"
      method="GET"
      handle-as="json"
      last-response={{quotes}}
    ></iron-ajax>

    <app-indexeddb-mirror
      key="{{appStorageKey}}"
      data="{{quotes}}"
      persisted-data="{{cacheQuotes}}"
      log=true
    >
    </app-indexeddb-mirror>

    <iron-swipeable-container swipe-style="curve" width-ratio="1">
      <template is="dom-repeat" items={{cacheQuotes.quotes}}>
        <div>{{item.body}}</div>
      </template>
    </iron-swipeable-container>

    <footer>
      Jim Rohn quotes from
      <a href="https://favqs.com/api">favqs</a>
    </footer>

  </template>

  <script>
    /** @polymerElement */
    class Quote_centerApp extends Polymer.Element {
      static get is() { return 'quote_center-app'; }
      static get properties() {
        return {
          quotes: {
            type: Array
          },
          appStorageKey: {
            type: String,
            value: "cara-iu-vau"
          },
          dataFiles: {
            type: Array,
            value: [
              "JimRohn.json", "bestlife.json"
            ]
          },
          selected: {
            type: Number,
            value: 0,
            observer: "_selectedChanged"
          },

          dataUrl: {
            type: String
          }
        };
      }

      _selectedChanged() {
        this._calculateDataUrl();
      }

      _calculateDataUrl() {
        this.dataUrl = "/data/" + this.dataFiles[this.selected];
      }
    }

    window.customElements.define(Quote_centerApp.is, Quote_centerApp);
  </script>
</dom-module>
